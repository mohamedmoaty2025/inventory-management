{% extends "base.html" %}
{% load static %}

{% block title %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª{% endblock %}

{% block content %}
<style>
    .product-card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background-color: #fff;
        display: flex;
        align-items: center;
        box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }

    .product-card img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        margin-left: 20px;
    }

    .product-info {
        flex-grow: 1;
    }

    .product-info strong {
        font-size: 20px;
        color: #007bff;
    }

    .actions a {
        margin-left: 10px;
    }

    .category-title {
        margin-top: 40px;
        margin-bottom: 20px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
        font-size: 22px;
        color: #007bff;
    }

    .top-products {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .top-products h4 {
        margin-bottom: 15px;
        color: #28a745;
    }

    .top-products ul {
        padding-left: 20px;
    }
</style>

<div class="container">

    <!-- âœ… Ø¹Ø±Ø¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="alert alert-success">
                ğŸ’° <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…:</strong>
                {{ total_today|floatformat:2 }} Ø¬Ù†ÙŠÙ‡
            </div>
        </div>
        <div class="col-md-6">
            <div class="alert alert-primary">
                ğŸ“… <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±:</strong>
                {{ total_month|floatformat:2 }} Ø¬Ù†ÙŠÙ‡
            </div>
        </div>
    </div>

    <!-- âœ… Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø´Ø±Ø§Ø¡Ù‹ -->
    {% if top_purchased %}
    <div class="top-products">
        <h4>ğŸ”¥ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø´Ø±Ø§Ø¡Ù‹:</h4>
        <ul>
            {% for item in top_purchased %}
                <li>
                    <strong>{{ item.product__name }}</strong> - ØªÙ… Ø´Ø±Ø§Ø¡Ù‡ <strong>{{ item.total_quantity }}</strong> Ù…Ø±Ø©
                </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- âœ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">ğŸ“¦ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
        <form method="get" class="d-flex">
            <input type="text" name="q" class="form-control me-2" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" value="{{ request.GET.q }}">
            <button type="submit" class="btn btn-outline-primary">Ø¨Ø­Ø«</button>
        </form>
    </div>

    <!-- âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    {% if request.GET.q %}
        <!-- âœ… Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
        {% if products %}
            <h4 class="text-success">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "{{ request.GET.q }}"</h4>
            {% for product in products %}
            <div class="product-card">
                {% if product.get_image %}
                    <img src="{{ product.get_image }}" alt="{{ product.name }}">
                {% else %}
                    <img src="{% static 'images/no-image.png' %}" alt="no image">
                {% endif %}

                <div class="product-info">
                    <strong>{{ product.name }}</strong>
                    <p class="mb-1">Ø§Ù„Ø³Ø¹Ø±: {{ product.price }} Ø¬Ù†ÙŠÙ‡</p>
                    <p class="mb-1">Ø§Ù„ÙƒÙ…ÙŠØ©: {{ product.quantity }}</p>
                </div>
                <div class="actions">
                    <a href="{% url 'product-edit' product.pk %}" class="btn btn-sm btn-info">ØªØ¹Ø¯ÙŠÙ„</a>
                    <a href="{% url 'product-delete' product.pk %}" class="btn btn-sm btn-danger">Ø­Ø°Ù</a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-warning text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«.</div>
        {% endif %}
    {% else %}
        <!-- âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
        {% if categories %}
            {% for category in categories %}
                {% with category.products.all as products %}
                    {% if products %}
                        <div class="category-title">{{ category.name }}</div>
                        {% for product in products %}
                        <div class="product-card">
                            {% if product.get_image %}
                                <img src="{{ product.get_image }}" alt="{{ product.name }}">
                            {% else %}
                                <img src="{% static 'images/no-image.png' %}" alt="no image">
                            {% endif %}

                            <div class="product-info">
                                <strong>{{ product.name }}</strong>
                                <p class="mb-1">Ø§Ù„Ø³Ø¹Ø±: {{ product.price }} Ø¬Ù†ÙŠÙ‡</p>
                                <p class="mb-1">Ø§Ù„ÙƒÙ…ÙŠØ©: {{ product.quantity }}</p>
                            </div>
                            <div class="actions">
                                <a href="{% url 'product-edit' product.pk %}" class="btn btn-sm btn-info">ØªØ¹Ø¯ÙŠÙ„</a>
                                <a href="{% url 'product-delete' product.pk %}" class="btn btn-sm btn-danger">Ø­Ø°Ù</a>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            {% endfor %}
        {% else %}
            <div class="alert alert-info text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>
        {% endif %}
    {% endif %}

    <a href="{% url 'category-add' %}" class="btn btn-outline-success mt-4">â• Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©</a>

</div>
{% endblock %}
